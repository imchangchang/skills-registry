# STM32 时钟配置详解

> 本文档详细说明 STM32 F4/F7/H7 系列的时钟树配置。
> 
> 状态：待完善（由 SKILL.md 引用创建）

## 时钟树概述

```
                    HSE (外部晶振)
                       |
                       v
              +-------------------+
              |      PLL          |
              |  (倍频系统时钟)    |
              +---------+---------+
                        |
                        v
              +-------------------+
              |   SYSCLK (系统时钟) |
              +---------+---------+
                        |
        +---------------+---------------+
        |               |               |
        v               v               v
   +---------+    +---------+    +---------+
   |   AHB   |    |   APB1  |    |   APB2  |
   | (高速)  |    | (低速)  |    | (高速)  |
   +---------+    +---------+    +---------+
```

## F4 系列时钟配置

### 典型配置（168MHz）

```c
// HSE = 8MHz, 目标 SYSCLK = 168MHz
// PLLM = 8, PLLN = 336, PLLP = 2, PLLQ = 7
// SYSCLK = 8MHz / 8 * 336 / 2 = 168MHz
```

## F7 系列时钟配置

### 典型配置（216MHz）

```c
// HSE = 8MHz, 目标 SYSCLK = 216MHz
// PLLM = 8, PLLN = 432, PLLP = 2, PLLQ = 9
// SYSCLK = 8MHz / 8 * 432 / 2 = 216MHz
```

## H7 系列时钟配置

### 特殊注意事项

H7 系列需要额外配置 PWR 寄存器：

```c
// 使能电压调节器
__HAL_RCC_PWR_CLK_ENABLE();
__HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);
```

### 典型配置（480MHz）

```c
// HSE = 25MHz, 目标 SYSCLK = 480MHz
// 需要通过 PLL1 配置
```

## 常见错误

### 错误 1：时钟源未就绪
**现象**：配置后程序卡死
**原因**：等待时钟源就绪超时
**解决**：检查晶振是否连接，或改用 HSI

### 错误 2：分频器配置错误
**现象**：外设时钟不正确，串口波特率错误
**原因**：APB1/APB2 分频系数错误
**解决**：核对参考手册中的时钟树

## 待完善内容

- [ ] 各系列详细的 PLL 配置参数表
- [ ] USB 时钟配置说明
- [ ] 低功耗时钟配置
- [ ] 时钟安全系统（CSS）使用
